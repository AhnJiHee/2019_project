<%@page import="vo.BoardVO"%>
<%@page import="java.util.ArrayList"%>
<%@page import="dao.BoardDAO"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>게시물 리스트</title>

<style>
table{text-align: center; margin: auto; border: 3px solid purple;}
</style>

<!-- Jquery 작성부 -->
<script src="jquery-3.2.1.min.js"></script>
<script>
$(document).ready(function(){
	$("#write").on('click', function(){
		location.href="boardwriteform.jsp"
	}); // onclick end
}); // ready end
</script>
</head>

<body>

<table border="2px">
<tr>
<td>번호</td><td width="250">제목</td><td>작성자</td><td>작성시간</td><td>조회수</td>
</tr>

<!-- 전역 변수 선언부 -->
<%!
	BoardDAO dao = new BoardDAO(); 
	int pagenum = dao.getTotalPage();
	ArrayList<BoardVO> list = dao.getBoardList();
	int [] pageinfo = dao.getPage(list, 1);
%>

<!-- 
int pagenum = 1;
if(request.getParameter("page") != null){
	pagenum = Integer.parseInt(request.getParameter("page"));
}
BoardDAO dao = new BoardDAO();
ArrayList<BoardVO> list = dao.getBoardList(pagenum, 3);
-->


<!--게시물 목록 출력-->
<% 
	if (request.getParameter("page") != null) { // 페이지 번호 요청
		int pagerequest = Integer.parseInt(request.getParameter("page"));
		pageinfo = dao.getPage(list, pagerequest);		
		int pagetotal = dao.getTotalPage();
	}

	/* try{ // 정상 출력 경우 */
		for (int i = pageinfo[4]; i <= pageinfo[5]; i++) {
		ArrayList<BoardVO> list = dao.getBoardList(); // 객체를 다시 안만들면 새로고침이 안된다
		BoardVO vo = list.get(i);
		out.println ("<tr><td>" + vo.getBoardseq() + "</td><td>"
							+ "<a href = 'boarddetails.jsp?boardseq="+vo.getBoardseq()+" '>"
							+ vo.getBoardtitle() + "</a></td><td>"
							+ vo.getBoardwriter() + "</td><td>"
							+ vo.getBoardtime() + "</td><td>"
							+ vo.getBoardviewcount() + "</td></tr>");
		}
	/* } catch (IndexOutOfBoundsException e) { // 남은 게시물 수가 적을 경우
		for (int i = pageinfo[4]; i < pageinfo[3]; i++) {
			ArrayList<BoardVO> list = dao.getBoardList();
			BoardVO vo = list.get(i);
			out.println ("<tr><td>" + vo.getBoardseq() + "</td><td>"
								+ "<a href = 'boarddetails.jsp?boardseq="+vo.getBoardseq()+" '>"
								+ vo.getBoardtitle() + "</a></td><td>"
								+ vo.getBoardwriter() + "</td><td>"
								+ vo.getBoardtime() + "</td><td>"
								+ vo.getBoardviewcount() + "</td></tr>");
		} */
	} // catch end
	
%> 




<h1 align = center>게시판 목록입니다.</h1>
<tr>
	<form action="boardlistsearch.jsp">
	<td colspan="2"><input type=text name="word" placeholder="검색할 내용을 입력하세요."></td>
	<td><select name="tag">
		<option value="boardtitle">제목</option>
		<option value="boardcontents">내용</option>
		<option value="boardwriter">작성자</option>
		</select></td>
	<td><input type = submit value = "검색 버튼"/></td>
	</form>
	<td><input type = button id = "write" value = "글쓰기 버튼"/></td>
</tr>
</table> 

<table>
<tr>
<form action = "boardlist.jsp">
<!--페이지 번호-->
<%
for (int i =1 ; i <= pagetotal ; i ++){
out.print("<td><input type=submit name='page' value='"+i+"'></td>");
}
%>
</form>
</tr>
</table>


</body>
</html>